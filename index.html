<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="PipeFlow Pro - Motor de cálculo hidráulico industrial para simulación de pérdidas de presión en sistemas de tuberías">
    <meta name="keywords" content="hidráulica, presión, tuberías, ingeniería, cálculo, simulación">
    <meta name="author" content="Antony Picon">

    <!-- Open Graph -->
    <meta property="og:title" content="PipeFlow Pro | Engineering Dashboard">
    <meta property="og:description" content="Simulación termofísica y análisis de pérdidas de presión en tuberías">
    <meta property="og:type" content="website">

    <title>PipeFlow Pro | Engineering Dashboard</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚙️</text></svg>">

    <!-- KaTeX para renderizado de fórmulas -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Ber8TPZR4i5LZrDOKNP7xlLdU2/bv5FZMiE1OPoE"
        crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-title">
                    <h1>⚙️ PipeFlow Pro</h1>
                    <p>Simulación Termofísica y Análisis de Pérdidas</p>
                </div>
                <div class="header-status">
                    <span id="server-status" class="status-indicator offline" title="Estado del servidor"></span>
                    <span class="status-label">API</span>
                </div>
            </div>
        </header>

        <main class="calc-grid">
            <div class="input-column">
                <section class="card" aria-labelledby="params-title">
                    <h3 id="params-title">1. Parámetros del Sistema</h3>
                    <form id="calcForm" autocomplete="off">
                        <div class="form-group">
                            <label for="fluido">Fluido (CoolProp Engine)</label>
                            <select id="fluido" aria-describedby="fluido-help">
                                <option value="Methane">Gas Natural (Metano)</option>
                                <option value="Water">Agua Inyectada</option>
                                <option value="Ethane">Etano</option>
                                <option value="Hydrogen">Hidrógeno (H₂)</option>
                                <option value="Nitrogen">Nitrógeno (N₂)</option>
                                <option value="CarbonDioxide">Dióxido de Carbono (CO₂)</option>
                                <option value="Propane">Propano</option>
                            </select>
                            <small id="fluido-help" class="input-help">Propiedades calculadas con CoolProp</small>
                        </div>

                        <div class="input-group">
                            <div class="form-group">
                                <label for="presion">Presión (bar)</label>
                                <input type="number" id="presion" value="70" step="0.1" min="0.01" max="10000"
                                    aria-describedby="presion-help" required>
                                <small id="presion-help" class="input-help">Presión absoluta del sistema</small>
                            </div>
                            <div class="form-group">
                                <label for="temp">Temperatura (°C)</label>
                                <input type="number" id="temp" value="25" step="0.1" min="-200" max="500"
                                    aria-describedby="temp-help" required>
                                <small id="temp-help" class="input-help">Temperatura de operación</small>
                            </div>
                        </div>

                        <div class="input-group">
                            <div class="form-group">
                                <label for="diametro">Diámetro Ext. (m)</label>
                                <input type="number" id="diametro" value="0.12" step="0.001" min="0.001" max="10"
                                    aria-describedby="diametro-help" required>
                                <small id="diametro-help" class="input-help">Diámetro exterior de tubería</small>
                            </div>
                            <div class="form-group">
                                <label for="velocidad">Velocidad (m/s)</label>
                                <input type="number" id="velocidad" value="2.0" step="0.1" min="0" max="100"
                                    aria-describedby="velocidad-help" required>
                                <small id="velocidad-help" class="input-help">Velocidad del flujo</small>
                            </div>
                        </div>
                    </form>
                </section>

                <section class="card" aria-labelledby="accesorios-title">
                    <div class="card-header">
                        <h3 id="accesorios-title">2. Accesorios (K-Factors)</h3>
                        <button type="button" class="btn-add" onclick="agregarFilaAccesorio()"
                            aria-label="Agregar accesorio">
                            + Agregar
                        </button>
                    </div>
                    <p class="card-description">Coeficientes basados en Crane TP-410</p>
                    <div id="contenedor-accesorios" role="list" aria-label="Lista de accesorios">
                    </div>
                </section>

                <button type="button" class="btn-primary" id="btn-calcular" onclick="enviarDatos()"
                    aria-describedby="calc-help">
                    EJECUTAR CÁLCULO SISTEMA
                </button>
                <small id="calc-help" class="btn-help">Envía los datos al motor CoolProp + Fluids</small>
            </div>

            <div class="result-column">
                <section class="card results-card" aria-labelledby="results-title">
                    <h3 id="results-title">3. Reporte de Operación</h3>
                    <div id="loading" class="loading-state hidden">
                        <div class="spinner"></div>
                        <span>Consultando Backend (CoolProp + Fluids)...</span>
                    </div>

                    <div id="display-results">
                        <div class="result-item main-res">
                            <span>Caída de Presión Total</span>
                            <div class="result-value">
                                <strong id="res_dp">--</strong>
                                <small>Pa</small>
                            </div>
                        </div>

                        <div class="result-item">
                            <span>Densidad Real <span class="formula">$\rho$</span></span>
                            <div class="result-value">
                                <strong id="res_rho">--</strong>
                                <small>kg/m³</small>
                            </div>
                        </div>

                        <div class="result-item">
                            <span>Número de Reynolds</span>
                            <div class="result-value">
                                <strong id="res_re">--</strong>
                            </div>
                        </div>

                        <div class="result-item">
                            <span>Factor de Fricción <span class="formula">$f$</span></span>
                            <div class="result-value">
                                <strong id="res_f">--</strong>
                            </div>
                        </div>

                        <div class="result-item">
                            <span>Régimen de Flujo</span>
                            <div class="result-value">
                                <strong id="res_regimen">--</strong>
                            </div>
                        </div>

                        <div class="result-item">
                            <span><span class="formula">$\sum K$</span> Accesorios</span>
                            <div class="result-value">
                                <strong id="res_k">0.00</strong>
                            </div>
                        </div>
                    </div>

                    <div id="design-alert" class="alert hidden" role="alert" aria-live="polite"></div>
                </section>
            </div>
        </main>

        <script src="script.js"></script>
        <script>
            // Renderizar fórmulas KaTeX cuando el documento esté listo
            document.addEventListener("DOMContentLoaded", function () {
                if (typeof renderMathInElement !== 'undefined') {
                    renderMathInElement(document.body, {
                        delimiters: [
                            { left: '$$', right: '$$', display: true },
                            { left: '$', right: '$', display: false }
                        ],
                        throwOnError: false
                    });
                }


            });
        </script>
</body>

</html>